- name: Enable NVIDIA GPUs on compute nodes (Ubuntu)
  hosts: compute
  become: yes
  gather_facts: yes
  roles:
    - role: nvidia_gpu

# ─────────────────────────────────────────────────────────────────
# controller 端：讓 GRES 變更即時生效
- name: Reconfigure slurmctld after GPU enable
  hosts: controller
  become: yes
  gather_facts: no
  tasks:
    - name: scontrol reconfigure
      ansible.builtin.command: scontrol reconfigure
      changed_when: true
